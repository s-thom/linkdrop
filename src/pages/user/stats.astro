---
import AuthLayout from "~/layouts/AuthLayout.astro";
import UserSidebar from "~/components/UserSidebar.astro";
import { CommonLinks } from "~/components/user/CommonLinks";
import { CommonTags } from "~/components/user/CommonTags";
import { StatsHeading } from "~/components/user/StatsHeading";
import { getUserSummary } from "~/lib/models/user.server";
import { getUserById } from "~/lib/models/user.server";

const userId = Astro.locals.userId!;
const user = await getUserById(userId);
if (!user) return new Response("Not Found", { status: 404 });

const summary = await getUserSummary(userId);
const { numLinks, commonTags, commonLinks } = summary;
---

<AuthLayout title="Stats">
  <div class="flex flex-col md:flex-row md:justify-center">
    <UserSidebar isAdmin={user.isAdmin} />
    <main class="flex-1 p-6 md:max-w-xl lg:max-w-2xl">
      <div class="flex flex-col gap-4">
        <StatsHeading user={summary.user} numLinks={numLinks} client:load />
        <CommonTags commonTags={commonTags} client:load />
        <CommonLinks commonLinks={commonLinks} client:load />
        <p class="text-sm">
          More info may come here later. If you have ideas, you can suggest them
          by{" "}
          <a
            href="https://github.com/s-thom/linkdrop/issues/new/choose"
            target="_blank"
            rel="noreferrer nofollow"
            class="text-nav-link underline decoration-1 hover:text-nav-link hover:no-underline active:text-nav-link-active"
          >
            creating an issue in GitHub
          </a>.
        </p>
      </div>
    </main>
  </div>
</AuthLayout>
